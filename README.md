## 操作系统实践课
### 阶段性任务
时间： 2025-9-15
进度： 实验二完成，Printf模块优化完成

## 项目概述

这是一个最小化的 RISC-V 操作系统内核，实现了基本的系统启动、内存管理和高级格式化输出功能。该项目旨在展示操作系统内核的基本原理和 RISC-V 架构的底层编程。

## 功能特性

### 🚀 核心功能
- **系统启动** - RISC-V 架构的引导和初始化
- **内存管理** - 基本的内存布局和管理
- **串口通信** - UART 驱动程序，支持字符和字符串输出

### 📺 高级输出系统
- **格式化输出** - 完整的 printf 实现，支持：
  - `%d` - 十进制整数（支持负数和 INT_MIN）
  - `%u` - 无符号十进制整数
  - `%x` - 十六进制整数
  - `%c` - 字符输出
  - `%s` - 字符串输出（支持 NULL 指针处理）
  - `%p` - 指针地址输出
  - `%b` - 二进制输出
  - `%o` - 八进制输出
  - `%%` - 百分号字符
- **输出缓冲** - 智能缓冲机制提高输出性能
- **查表优化** - 小数字（0-99）快速转换

### 🎨 终端控制功能
- **清屏控制** - ANSI 转义序列实现屏幕清除
- **光标控制** - 光标定位和移动功能
- **行清除功能** - 清除一行的内容
- **颜色控制** - ANSI 颜色支持

## 技术亮点

### 性能优化
1. **缓冲输出** - Printf 使用 128 字节缓冲区，减少系统调用
2. **批量传输** - UART 字符串批量发送，提高串口效率
3. **查表法** - 小数字转换使用预计算表，避免除法运算
4. **智能刷新** - 遇到格式化占位符时智能刷新缓冲区

### 边界处理
1. **INT_MIN 处理** - 正确处理有符号整数的最小值溢出问题
2. **NULL 指针安全** - 字符串输出自动处理 NULL 指针
3. **缓冲区保护** - 防止缓冲区溢出，自动刷新机制

### ANSI 标准兼容
- 支持标准 ANSI 转义序列
- 兼容现代终端模拟器
- 在 QEMU 中完美显示彩色输出和光标控制

## 项目结构

```
riscv-os/
├── kernel/
│   ├── start.c          # 系统启动和测试代码
│   ├── printf.c         # 格式化输出和终端控制
│   ├── printf.h         # Printf 模块头文件
│   ├── uart.c          # 串口驱动（优化版）
│   └── uart.h          # 串口驱动头文件
├── Makefile            # 构建配置
└── README.md           # 项目文档
```

## 快速开始

### 编译运行
```bash
# 编译项目
make clean
make

# 在 QEMU 中运行
make qemu
```

### 测试功能
系统启动后会自动运行各种测试：
- Printf 格式化输出测试
- 边界情况测试（INT_MIN、UINT_MAX 等）
- 光标移动和定位测试
- 颜色输出演示
- 终端控制功能展示


## 技术规格

- **目标架构**: RISC-V 64-bit
- **开发环境**: Ubuntu 24.04.2 LTS
- **编译器**: GCC RISC-V Cross Compiler
- **模拟器**: QEMU 系统模拟
- **代码标准**: C99
- **文档格式**: Markdown

---

**开发时间**: 2025年9月13日-15日  
**项目状态**: 实验二完成，Printf模块优化完成  
**下一阶段**: 中断处理和进程管理